#!/bin/dash

#Error check: commit has 2 arguments
if [ "$#" -ne 2 ] 
then 
    echo "usage: tigger-commit [-a] -m commit-message"
    exit 1
fi

# Error check: .tigger exists
if [ ! -d ".tigger" ]
then
    echo "tigger-commit: error: tigger repository directory .tigger not found"
    exit 1
fi

# Error check: .tigger/index is not empty
if [ -z "$(ls -A .tigger/index)" ]
then
    echo "nothing to commit"
    exit 1
fi

# Get latest commit number
count=0
while true
do 
    if [ ! -d ".tigger/$count" ] 
    then
        break
    fi
    count=$((count + 1))
done

last_commit=$((count - 1))
new_commit=$count

mkdir ".tigger/$new_commit"
for file in .tigger/index/*
do 
    cp "$file" .tigger/"$new_commit"
done
echo "$2" > .tigger/"$new_commit"/message
echo "Committed as commit $new_commit"

